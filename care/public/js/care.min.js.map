{"version":3,"file":"care.min.js","sources":["../../../../apps/care/care/public/js/tax_contoller.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n\nfrappe.provide(\"care.care\");\n\ncare.care.ReceivingController = frappe.ui.form.Controller.extend({\n    setup: function(frm, cdt, cdn) {\n        var me = this;\n        frappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.set_dynamic_labels();\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\n\t\t\tif(frm.doc.additional_discount_percentage) {\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\n\t\t\t} else {\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\t\t});\n    },\n    onload: function(doc, cdt, cdn){\n        var me = this;\n        if(this.frm.fields_dict[\"items\"].grid.get_field('item_code')) {\n\t\t\tthis.frm.set_query(\"item_tax_template\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\treturn me.set_query_for_item_tax_template(doc, cdt, cdn)\n\t\t\t});\n\t\t}\n    },\n    onload_post_render: function() {\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\n\t\t\t&& !(this.frm.doc.__onload ? this.frm.doc.__onload.load_after_mapping : false)) {\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\n\t\t\t&& !this.frm.doc.is_pos) {\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\n\t\t}\n\t},\n\tset_query_for_item_tax_template: function(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(!item.item_code) {\n\t\t\treturn doc.company ? {filters: {company: doc.company}} : {};\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'valid_from': [\"<=\", doc.transaction_date || doc.bill_date || doc.posting_date],\n\t\t\t\t'item_group': item.item_group,\n\t\t\t}\n\n\t\t\tif (doc.tax_category)\n\t\t\t\tfilters['tax_category'] = doc.tax_category;\n\t\t\tif (doc.company)\n\t\t\t\tfilters['company'] = doc.company;\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.controllers.queries.get_tax_template\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t},\n\tapply_default_taxes() {\n\t\tvar me = this;\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\tme.frm.doc.name);\n\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (taxes_and_charges_field) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges || \"\",\n\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t},\n\t\t\t\tdebounce: 2000,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// set taxes table\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tvalidate: function() {\n\t\tthis.calculate_taxes_and_totals(false);\n\t},\n\ttaxes_and_charges: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.taxes_and_charges) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\t\t\t\tthis.frm.doc.name).options,\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(me.frm.doc.shipping_rule && me.frm.doc.taxes) {\n\t\t\t\t\t\t\tfor (let tax of r.message) {\n\t\t\t\t\t\t\t\tme.frm.add_child(\"taxes\", tax);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trefresh_field(\"taxes\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\n\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tcalculate_taxes_and_totals: async function(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\tawait this.calculate_shipping_charges();\n\n//\t\t Advance calculation applicable to Sales /Purchase Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2 && !this.frm.doc.is_return) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\tif (in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_pos &&\n\t\t\tthis.frm.doc.is_return) {\n\t\t\tif (this.frm.doc.doctype == \"Sales Invoice\") {\n\t\t\t\tthis.set_total_amount_to_default_mop();\n\t\t\t}\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tcalculate_discount_amount: function() {\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t},\n\n\t_calculate_taxes_and_totals: function() {\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t},\n\titem_tax_template: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(item.item_tax_template) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_map\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\tas_json: true\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\titem.item_tax_rate = r.message;\n\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titem.item_tax_rate = \"{}\";\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t},\n\tadd_taxes_from_item_tax_template: function(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif (item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif (typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif (!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tcalculate_item_values: function() {\n\t\tlet me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\t\t\t\titem.amount = flt((item.rate * item.qty) - item.discount, precision(\"amount\", item));\n\t\t\t\titem.net_amount = item.amount;\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_in_company_currency: function(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t},\n\n\tinitialize_taxes: function() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\ttax.item_wise_tax_detail = {};\n\t\t\t}\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n//\t\t\tif (!this.discount_amount_applied && cur_frm) {\n//\t\t\t\tcur_frm.cscript.validate_taxes_and_charges(tax.doctype, tax.name);\n//\t\t\t\tme.validate_inclusive_tax(tax);\n//\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t},\n\n\tfetch_round_off_accounts: function() {\n\t\tlet me = this;\n\t\tfrappe.flags.round_off_applicable_accounts = [];\n\n\t\tif (me.frm.doc.company) {\n\t\t\treturn frappe.call({\n\t\t\t\t\"method\": \"erpnext.controllers.taxes_and_totals.get_round_off_applicable_accounts\",\n\t\t\t\t\"args\": {\n\t\t\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\t\t\"account_list\": frappe.flags.round_off_applicable_accounts\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.flags.round_off_applicable_accounts.push(...r.message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tdetermine_exclusive_rate: function() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\t\t\tvar total_inclusive_tax_amount_per_qty = 0;\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tvar current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n\t\t\t\ttax.tax_fraction_for_current_item = current_tax_fraction[0];\n\t\t\t\tvar inclusive_tax_amount_per_qty = current_tax_fraction[1];\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t\ttotal_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(item.qty);\n\t\t\t});\n\n\t\t\tif(!me.discount_amount_applied && item.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n\t\t\t\tvar amount = flt(item.amount) - total_inclusive_tax_amount_per_qty;\n\t\t\t\titem.net_amount = flt(amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t},\n\n\tget_current_tax_fraction: function(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\t\tvar inclusive_tax_amount_per_qty = 0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\t\tinclusive_tax_amount_per_qty = flt(tax_rate);\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax && tax.add_deduct_tax == \"Deduct\") {\n\t\t\tcurrent_tax_fraction *= -1;\n\t\t\tinclusive_tax_amount_per_qty *= -1;\n\t\t}\n\t\treturn [current_tax_fraction, inclusive_tax_amount_per_qty];\n\t},\n\n\t_get_tax_rate: function(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t},\n\n\tcalculate_net_total: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t\t});\n\t},\n\n\tcalculate_shipping_charges: function() {\n\t\t// Do not apply shipping rule for POS\n\t\tif (this.frm.doc.is_pos) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"shipping_rule\", this.frm.doc.name)) {\n\t\t\treturn this.shipping_rule();\n\t\t}\n\t},\n\n\tcalculate_taxes: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax, [\"total\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_cumulative_total: function(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t},\n\n\t_load_item_tax_rate: function(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t},\n\n\tget_current_tax_amount: function(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\t// To set row_id by default as previous row.\n\t\tif([\"On Previous Row Amount\", \"On Previous Row Total\"].includes(tax.charge_type)) {\n\t\t\tif (tax.idx === 1) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Cannot select charge type as 'On Previous Row Amount' or 'On Previous Row Total' for first row\"));\n\t\t\t}\n\t\t\tif (!tax.row_id) {\n\t\t\t\ttax.row_id = tax.idx - 1;\n\t\t\t}\n\t\t}\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\tcurrent_tax_amount = tax_rate * item.qty;\n\t\t}\n\n\t\tif (!tax.dont_recompute_tax) {\n\t\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\t\t}\n\n\t\treturn current_tax_amount;\n\t},\n\n\tset_item_wise_tax: function(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tif(typeof (tax_detail) == \"string\") {\n\t\t\ttax.item_wise_tax_detail = JSON.parse(tax.item_wise_tax_detail);\n\t\t\ttax_detail = tax.item_wise_tax_detail;\n\t\t}\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (tax_detail && tax_detail[key])\n\t\t\titem_wise_tax_amount += tax_detail[key][1];\n\n\t\ttax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t},\n\tmanipulate_grand_total_for_inclusive_tax: function() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif(me.discount_amount_applied && me.frm.doc.discount_amount) {\n\t\t\t\t\tdiff -= flt(me.frm.doc.discount_amount);\n\t\t\t\t}\n\n\t\t\t\tdiff = flt(diff, precision(\"rounding_adjustment\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tme.frm.doc.rounding_adjustment = diff;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_totals: function() {\n\t\t// Changing sequence can because of rounding adjustment issue and on-screen discrepancy\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t},\n\n\tset_rounded_total: function() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t},\n\n\t_cleanup: function() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\n\t\tif(this.frm.doc[\"items\"] && this.frm.doc[\"items\"].length) {\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"items\"][0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tset_discount_amount: function() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t},\n\n\tapply_discount_amount: function() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm.doc.items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t},\n\n\tget_total_for_discount_amount: function() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif (in_list([\"Actual\", \"On Item Quantity\"], tax.charge_type)) {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t},\n\n\tcalculate_total_advance: function(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tif (this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = 0;\n\t\t}\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t\tthis.calculate_write_off_amount();\n\t},\n\n\tis_internal_invoice: function() {\n\t\tif (['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tif (this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\tcalculate_outstanding_amount: function(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif (this.frm.doc.is_return || (this.frm.doc.docstatus > 0) || this.is_internal_invoice()) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(base_grand_total, precision(\"base_grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t},\n\n\tset_total_amount_to_default_mop: function() {\n\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t} else {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t(flt(base_grand_total, precision(\"base_grand_total\"))\n\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t);\n\t\t}\n\t\tthis.frm.doc.payments.find(pay => {\n\t\t\tif (pay.default) {\n\t\t\t\tpay.amount = total_amount_to_pay;\n\t\t\t}\n\t\t});\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tset_default_payment: function(total_amount_to_pay, update_paid_amount) {\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data) {\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tlet base_amount = flt(total_amount_to_pay, precision(\"base_amount\", data));\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"base_amount\", base_amount);\n\t\t\t\t\tlet amount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\", data));\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", amount);\n\t\t\t\t\tpayment_status = false;\n\t\t\t\t} else if(me.frm.doc.paid_amount) {\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", 0.0);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcalculate_paid_amount: function() {\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.set_value('paid_amount', flt(paid_amount, precision(\"paid_amount\")));\n\t\tthis.frm.set_value('base_paid_amount', flt(base_paid_amount, precision(\"base_paid_amount\")));\n\t},\n\n\tcalculate_change_amount: function() {\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total,\n\t\t\t\t\tprecision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total, precision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_write_off_amount: function() {\n\t\tif (this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.outstanding_amount, precision(\"write_off_amount\"));\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\n\t\t\tthis.calculate_outstanding_amount(false);\n\t\t}\n\n\t}\n});\n"],"names":["this","let"],"mappings":"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"}