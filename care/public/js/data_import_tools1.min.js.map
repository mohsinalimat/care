{"version":3,"file":"data_import_tools1.min.js","sources":["../../../../apps/care/care/public/js/data_import/data_exporter.js","../../../../apps/care/care/public/js/data_import/import_preview.js"],"sourcesContent":["frappe.provide('frappe.data_import');\n\nfrappe.data_import.DataExporter = class DataExporter {\n\tconstructor(doctype, exporting_for) {\n\t\tthis.doctype = doctype;\n\t\tthis.exporting_for = exporting_for;\n\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\tthis.make_dialog();\n\t\t});\n\t}\n\n\tmake_dialog() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Export Data'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'export_records',\n\t\t\t\t\tlabel: __('Export Type'),\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __('All Records'),\n\t\t\t\t\t\t\tvalue: 'all'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __('Filtered Records'),\n\t\t\t\t\t\t\tvalue: 'by_filter'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __('5 Records'),\n\t\t\t\t\t\t\tvalue: '5_records'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __('Blank Template'),\n\t\t\t\t\t\t\tvalue: 'blank_template'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tdefault: this.exporting_for === 'Insert New Records' ? 'blank_template' : 'all',\n\t\t\t\t\tchange: () => {\n\t\t\t\t\t\tthis.update_record_count_message();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\tfieldname: 'filter_area',\n\t\t\t\t\tdepends_on: doc => doc.export_records === 'by_filter'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'file_type',\n\t\t\t\t\tlabel: __('File Type'),\n\t\t\t\t\toptions: ['Excel', 'CSV'],\n\t\t\t\t\tdefault: 'CSV'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Section Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\tfieldname: 'select_all_buttons'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __(this.doctype),\n\t\t\t\t\tfieldname: this.doctype,\n\t\t\t\t\tfieldtype: 'MultiCheck',\n\t\t\t\t\tcolumns: 2,\n\t\t\t\t\ton_change: () => this.update_primary_action(),\n\t\t\t\t\toptions: this.get_multicheck_options(this.doctype)\n\t\t\t\t},\n\t\t\t\t...frappe.meta.get_table_fields(this.doctype).map(df => {\n\t\t\t\t\tlet doctype = df.options;\n\t\t\t\t\tlet child_fieldname = df.fieldname;\n\t\t\t\t\tlet label = df.reqd\n\t\t\t\t\t\t? // prettier-ignore\n\t\t\t\t\t\t  __('{0} ({1}) (1 row mandatory)', [__(df.label || df.fieldname), __(doctype)])\n\t\t\t\t\t\t: __('{0} ({1})', [__(df.label || df.fieldname), __(doctype)]);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlabel,\n\t\t\t\t\t\tfieldname: child_fieldname,\n\t\t\t\t\t\tfieldtype: 'MultiCheck',\n\t\t\t\t\t\tcolumns: 2,\n\t\t\t\t\t\ton_change: () => this.update_primary_action(),\n\t\t\t\t\t\toptions: this.get_multicheck_options(doctype, child_fieldname)\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t],\n\t\t\tprimary_action_label: __('Export'),\n\t\t\tprimary_action: values => this.export_records(values),\n\t\t\ton_page_show: () => this.select_mandatory()\n\t\t});\n\n\t\tthis.make_filter_area();\n\t\tthis.make_select_all_buttons();\n\t\tthis.update_record_count_message();\n\n\t\tthis.dialog.show();\n\t}\n\n\texport_records() {\n\t\tlet method =\n\t\t\t'/api/method/care.care.doctype.purchase_invoice_creation_tool.purchase_invoice_creation_tool.download_template';\n\n\t\tlet multicheck_fields = this.dialog.fields\n\t\t\t.filter(df => df.fieldtype === 'MultiCheck')\n\t\t\t.map(df => df.fieldname);\n\n\t\tlet values = this.dialog.get_values();\n\n\t\tlet doctype_field_map = Object.assign({}, values);\n\t\tfor (let key in doctype_field_map) {\n\t\t\tif (!multicheck_fields.includes(key)) {\n\t\t\t\tdelete doctype_field_map[key];\n\t\t\t}\n\t\t}\n\n\t\tlet filters = null;\n\t\tif (values.export_records === 'by_filter') {\n\t\t\tfilters = this.get_filters();\n\t\t}\n\n\t\topen_url_post(method, {\n\t\t\tdoctype: this.doctype,\n\t\t\tfile_type: values.file_type,\n\t\t\texport_records: values.export_records,\n\t\t\texport_fields: doctype_field_map,\n\t\t\texport_filters: filters\n\t\t});\n\t}\n\n\tmake_filter_area() {\n\t\tthis.filter_group = new frappe.ui.FilterGroup({\n\t\t\tparent: this.dialog.get_field('filter_area').$wrapper,\n\t\t\tdoctype: this.doctype,\n\t\t\ton_change: () => {\n\t\t\t\tthis.update_record_count_message();\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_select_all_buttons() {\n\t\tlet for_insert = this.exporting_for === 'Insert New Records';\n\t\tlet section_title = for_insert ? __('Select Fields To Insert') : __('Select Fields To Update');\n\t\tlet $select_all_buttons = $(`\n\t\t\t<div>\n\t\t\t\t<h6 class=\"form-section-heading uppercase\">${section_title}</h6>\n\t\t\t\t<button class=\"btn btn-default btn-xs\" data-action=\"select_all\">\n\t\t\t\t\t${__('Select All')}\n\t\t\t\t</button>\n\t\t\t\t${for_insert ? `<button class=\"btn btn-default btn-xs\" data-action=\"select_mandatory\">\n\t\t\t\t\t${__('Select Mandatory')}\n\t\t\t\t</button>`: ''}\n\t\t\t\t<button class=\"btn btn-default btn-xs\" data-action=\"unselect_all\">\n\t\t\t\t\t${__('Unselect All')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`);\n\t\tfrappe.utils.bind_actions_with_object($select_all_buttons, this);\n\t\tthis.dialog\n\t\t\t.get_field('select_all_buttons')\n\t\t\t.$wrapper.html($select_all_buttons);\n\t}\n\n\tselect_all() {\n\t\tthis.dialog.$wrapper\n\t\t\t.find(':checkbox')\n\t\t\t.prop('checked', true)\n\t\t\t.trigger('change');\n\t}\n\n\tselect_mandatory() {\n\t\tlet mandatory_table_fields = frappe.meta\n\t\t\t.get_table_fields(this.doctype)\n\t\t\t.filter(df => df.reqd)\n\t\t\t.map(df => df.fieldname);\n\t\tmandatory_table_fields.push(this.doctype);\n\n\t\tlet multicheck_fields = this.dialog.fields\n\t\t\t.filter(df => df.fieldtype === 'MultiCheck')\n\t\t\t.map(df => df.fieldname)\n\t\t\t.filter(doctype => mandatory_table_fields.includes(doctype));\n\n\t\tlet checkboxes = [].concat(\n\t\t\t...multicheck_fields.map(fieldname => {\n\t\t\t\tlet field = this.dialog.get_field(fieldname);\n\t\t\t\treturn field.options\n\t\t\t\t\t.filter(option => option.danger)\n\t\t\t\t\t.map(option => option.$checkbox.find('input').get(0));\n\t\t\t})\n\t\t);\n\n\t\tthis.unselect_all();\n\t\t$(checkboxes)\n\t\t\t.prop('checked', true)\n\t\t\t.trigger('change');\n\t}\n\n\tunselect_all() {\n\t\tlet update_existing_records =\n\t\t\tthis.dialog.get_value('exporting_for') == 'Update Existing Records';\n\t\tthis.dialog.$wrapper\n\t\t\t.find(\n\t\t\t\t`:checkbox${update_existing_records ? ':not([data-unit=name])' : ''}`\n\t\t\t)\n\t\t\t.prop('checked', false)\n\t\t\t.trigger('change');\n\t}\n\n\tupdate_record_count_message() {\n\t\tlet export_records = this.dialog.get_value('export_records');\n\t\tlet count_method = {\n\t\t\tall: () => frappe.db.count(this.doctype),\n\t\t\tby_filter: () =>\n\t\t\t\tfrappe.db.count(this.doctype, {\n\t\t\t\t\tfilters: this.get_filters()\n\t\t\t\t}),\n\t\t\tblank_template: () => Promise.resolve(0),\n\t\t\t'5_records': () => Promise.resolve(5)\n\t\t};\n\n\t\tcount_method[export_records]().then(value => {\n\t\t\tlet message = '';\n\t\t\tvalue = parseInt(value, 10);\n\t\t\tif (value === 0) {\n\t\t\t\tmessage = __('No records will be exported');\n\t\t\t} else if (value === 1) {\n\t\t\t\tmessage = __('1 record will be exported');\n\t\t\t} else {\n\t\t\t\tmessage = __('{0} records will be exported', [value]);\n\t\t\t}\n\t\t\tthis.dialog.set_df_property('export_records', 'description', message);\n\n\t\t\tthis.update_primary_action(value);\n\t\t});\n\t}\n\n\tupdate_primary_action(no_of_records) {\n\t\tlet $primary_action = this.dialog.get_primary_btn();\n\n\t\tif (no_of_records != null) {\n\t\t\tlet label = '';\n\t\t\tif (no_of_records === 0) {\n\t\t\t\tlabel = __('Export');\n\t\t\t} else if (no_of_records === 1) {\n\t\t\t\tlabel = __('Export 1 record');\n\t\t\t} else {\n\t\t\t\tlabel = __('Export {0} records', [no_of_records]);\n\t\t\t}\n\t\t\t$primary_action.html(label);\n\t\t} else {\n\t\t\tlet parent_fields = this.dialog.get_value(this.doctype);\n\t\t\t$primary_action.prop('disabled', parent_fields.length === 0);\n\t\t}\n\t}\n\n\tget_filters() {\n\t\treturn this.filter_group.get_filters().map(filter => {\n\t\t\treturn filter.slice(0, 4);\n\t\t});\n\t}\n\n\tget_multicheck_options(doctype, child_fieldname = null) {\n\t\tif (!this.column_map) {\n\t\t\tthis.column_map = get_columns_for_picker(this.doctype);\n\t\t}\n\n\t\tlet autoname_field = null;\n\t\tlet meta = frappe.get_meta(doctype);\n\t\tif (meta.autoname && meta.autoname.startsWith('field:')) {\n\t\t\tlet fieldname = meta.autoname.slice('field:'.length);\n\t\t\tautoname_field = frappe.meta.get_field(doctype, fieldname);\n\t\t}\n\n\t\tlet fields = child_fieldname\n\t\t\t? this.column_map[child_fieldname]\n\t\t\t: this.column_map[doctype];\n\n\t\tlet is_field_mandatory = df => {\n\t\t\tif (df.reqd && this.exporting_for == 'Insert New Records') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (autoname_field && df.fieldname == autoname_field.fieldname) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (df.fieldname === 'name') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\t\treturn fields\n\t\t\t.filter(df => {\n\t\t\t\tif (autoname_field && df.fieldname === 'name') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.map(df => {\n\t\t\t\treturn {\n\t\t\t\t\tlabel: __(df.label),\n\t\t\t\t\tvalue: df.fieldname,\n\t\t\t\t\tdanger: is_field_mandatory(df),\n\t\t\t\t\tchecked: false,\n\t\t\t\t\tdescription: `${df.fieldname} ${df.reqd ? __('(Mandatory)') : ''}`\n\t\t\t\t};\n\t\t\t});\n\t}\n};\n\nexport function get_columns_for_picker(doctype) {\n\tlet out = {};\n\n\tconst exportable_fields = df => {\n\t\tlet keep = true;\n\t\tif (frappe.model.no_value_type.includes(df.fieldtype)) {\n\t\t\tkeep = false;\n\t\t}\n\t\tif (['lft', 'rgt'].includes(df.fieldname)) {\n\t\t\tkeep = false;\n\t\t}\n\t\treturn keep;\n\t};\n\n\t// parent\n\tlet doctype_fields = frappe.meta\n\t\t.get_docfields(doctype)\n\t\t.filter(exportable_fields);\n\n\tout[doctype] = [\n\t\t{\n\t\t\tlabel: __('ID'),\n\t\t\tfieldname: 'name',\n\t\t\tfieldtype: 'Data',\n\t\t\treqd: 1\n\t\t}\n\t].concat(doctype_fields);\n\n\t// children\n\tconst table_fields = frappe.meta.get_table_fields(doctype);\n\ttable_fields.forEach(df => {\n\t\tconst cdt = df.options;\n\t\tconst child_table_fields = frappe.meta\n\t\t\t.get_docfields(cdt)\n\t\t\t.filter(exportable_fields);\n\n\t\tout[df.fieldname] = [\n\t\t\t{\n\t\t\t\tlabel: __('ID'),\n\t\t\t\tfieldname: 'name',\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\treqd: 1\n\t\t\t}\n\t\t].concat(child_table_fields);\n\t});\n\n\treturn out;\n}\n","import DataTable from 'frappe-datatable';\nimport { get_columns_for_picker } from './data_exporter';\n\nfrappe.provide('frappe.data_import');\n\nfrappe.data_import.ImportPreview = class ImportPreview {\n\tconstructor({\n\t\twrapper,\n\t\tdoctype,\n\t\tpreview_data,\n\t\tfrm,\n\t\timport_log,\n\t\tevents = {}\n\t}) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.doctype = doctype;\n\t\tthis.preview_data = preview_data;\n\t\tthis.events = events;\n\t\tthis.import_log = import_log;\n\t\tthis.frm = frm;\n\n\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\trefresh() {\n\t\tthis.data = this.preview_data.data;\n\t\tthis.make_wrapper();\n\t\tthis.prepare_columns();\n\t\tthis.prepare_data();\n\t\tthis.render_datatable();\n\t\tthis.setup_styles();\n\t\tthis.add_actions();\n\t}\n\n\tmake_wrapper() {\n\t\tthis.wrapper.html(`\n\t\t\t<div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<div class=\"col-sm-12\">\n\t\t\t\t\t\t<div class=\"table-actions margin-bottom\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"table-preview border\"></div>\n\t\t\t\t\t\t<div class=\"table-message\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t\tfrappe.utils.bind_actions_with_object(this.wrapper, this);\n\n\t\tthis.$table_preview = this.wrapper.find('.table-preview');\n\t}\n\n\tprepare_columns() {\n\t\tthis.columns = this.preview_data.columns.map((col, i) => {\n\t\t\tlet df = col.df;\n\t\t\tlet column_width = 120;\n\t\t\tif (col.header_title === 'Sr. No') {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'srno',\n\t\t\t\t\tname: 'Sr. No',\n\t\t\t\t\tcontent: 'Sr. No',\n\t\t\t\t\teditable: false,\n\t\t\t\t\tfocusable: false,\n\t\t\t\t\talign: 'left',\n\t\t\t\t\twidth: 60\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (col.skip_import) {\n\t\t\t\tlet show_warnings_button = `<button class=\"btn btn-xs\" data-action=\"show_column_warning\" data-col=\"${i}\">\n\t\t\t\t\t<i class=\"octicon octicon-stop\"></i></button>`;\n\t\t\t\tif (!col.df) {\n\t\t\t\t\t// increase column width for unidentified columns\n\t\t\t\t\tcolumn_width += 50;\n\t\t\t\t}\n\t\t\t\tlet column_title = `<span class=\"indicator red\">\n\t\t\t\t\t${col.header_title || `<i>${__('Untitled Column')}</i>`}\n\t\t\t\t\t${!col.df ? show_warnings_button : ''}\n\t\t\t\t</span>`;\n\t\t\t\treturn {\n\t\t\t\t\tid: frappe.utils.get_random(6),\n\t\t\t\t\tname: col.header_title || (df ? df.label : 'Untitled Column'),\n\t\t\t\t\tcontent: column_title,\n\t\t\t\t\tskip_import: true,\n\t\t\t\t\teditable: false,\n\t\t\t\t\tfocusable: false,\n\t\t\t\t\talign: 'left',\n\t\t\t\t\twidth: column_width,\n\t\t\t\t\tformat: value => `<div class=\"text-muted\">${value}</div>`\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet date_format = col.date_format\n\t\t\t\t? col.date_format\n\t\t\t\t\t.replace('%Y', 'yyyy')\n\t\t\t\t\t.replace('%y', 'yy')\n\t\t\t\t\t.replace('%m', 'mm')\n\t\t\t\t\t.replace('%d', 'dd')\n\t\t\t\t\t.replace('%H', 'HH')\n\t\t\t\t\t.replace('%M', 'mm')\n\t\t\t\t\t.replace('%S', 'ss')\n\t\t\t\t\t.replace('%b', 'Mon')\n\t\t\t\t: null;\n\n\t\t\tlet column_title = `<span class=\"indicator green\">\n\t\t\t\t${col.header_title || df.label}\n\t\t\t\t${date_format ? `(${date_format})` : ''}\n\t\t\t</span>`;\n\n\t\t\treturn {\n\t\t\t\tid: df.fieldname,\n\t\t\t\tname: col.header_title,\n\t\t\t\tcontent: column_title,\n\t\t\t\tdf: df,\n\t\t\t\teditable: false,\n\t\t\t\talign: 'left',\n\t\t\t\twidth: column_width\n\t\t\t};\n\t\t});\n\t}\n\n\tprepare_data() {\n\t\tthis.data = this.data.map(row => {\n\t\t\treturn row.map(cell => {\n\t\t\t\tif (cell == null) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t\treturn cell;\n\t\t\t});\n\t\t});\n\t}\n\n\trender_datatable() {\n\t\tif (this.datatable) {\n\t\t\tthis.datatable.destroy();\n\t\t}\n\n\t\tthis.datatable = new DataTable(this.$table_preview.get(0), {\n\t\t\tdata: this.data,\n\t\t\tcolumns: this.columns,\n\t\t\tlayout: this.columns.length < 10 ? 'fluid' : 'fixed',\n\t\t\tcellHeight: 35,\n\t\t\tserialNoColumn: false,\n\t\t\tcheckboxColumn: false,\n\t\t\tnoDataMessage: __('No Data'),\n\t\t\tdisableReorderColumn: true\n\t\t});\n\n\t\tlet {\n\t\t\tmax_rows_exceeded,\n\t\t\tmax_rows_in_preview,\n\t\t\ttotal_number_of_rows\n\t\t} = this.preview_data;\n\t\tif (max_rows_exceeded) {\n\t\t\tlet parts = [max_rows_in_preview, total_number_of_rows];\n\t\t\tthis.wrapper.find('.table-message').html(`\n\t\t\t\t<div class=\"text-muted margin-top text-medium\">\n\t\t\t\t${__('Showing only first {0} rows out of {1}', parts)}\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\n\t\tif (this.data.length === 0) {\n\t\t\tthis.datatable.style.setStyle('.dt-scrollable', {\n\t\t\t\theight: 'auto'\n\t\t\t});\n\t\t}\n\n\t\tthis.datatable.style.setStyle('.dt-dropdown', {\n\t\t\tdisplay: 'none'\n\t\t});\n\t}\n\n\tsetup_styles() {\n\t\t// import success checkbox\n\t\tthis.datatable.style.setStyle(`svg.import-success`, {\n\t\t\twidth: '16px',\n\t\t\tfill: frappe.ui.color.get_color_shade('green', 'dark')\n\t\t});\n\t\t// make successfully imported rows readonly\n\t\tlet row_classes = this.datatable\n\t\t\t.getRows()\n\t\t\t.filter(row => this.is_row_imported(row))\n\t\t\t.map(row => row.meta.rowIndex)\n\t\t\t.map(i => `.dt-row-${i} .dt-cell`)\n\t\t\t.join(',');\n\t\tthis.datatable.style.setStyle(row_classes, {\n\t\t\tpointerEvents: 'none',\n\t\t\tbackgroundColor: frappe.ui.color.get_color_shade('gray', 'extra-light'),\n\t\t\tcolor: frappe.ui.color.get_color_shade('gray', 'dark')\n\t\t});\n\t}\n\n\tadd_actions() {\n\t\tlet actions = [\n\t\t\t{\n\t\t\t\tlabel: __('Map Columns'),\n\t\t\t\thandler: 'show_column_mapper',\n\t\t\t\tcondition: this.frm.doc.status !== 'Success'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Export Errored Rows'),\n\t\t\t\thandler: 'export_errored_rows',\n\t\t\t\tcondition: this.import_log.filter(log => !log.success).length > 0\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Show Warnings'),\n\t\t\t\thandler: 'show_warnings',\n\t\t\t\tcondition: this.preview_data.warnings.length > 0\n\t\t\t}\n\t\t];\n\n\t\tlet html = actions\n\t\t\t.filter(action => action.condition)\n\t\t\t.map(action => {\n\t\t\t\treturn `<button class=\"btn btn-sm btn-default\" data-action=\"${action.handler}\">\n\t\t\t\t\t${action.label}\n\t\t\t\t</button>\n\t\t\t`;\n\t\t\t});\n\n\t\tthis.wrapper.find('.table-actions').html(html);\n\t}\n\n\texport_errored_rows() {\n\t\tthis.frm.trigger('export_errored_rows');\n\t}\n\n\tshow_warnings() {\n\t\tthis.frm.scroll_to_field('import_warnings');\n\t}\n\n\tshow_column_warning(_, $target) {\n\t\tlet $warning = this.frm\n\t\t\t.get_field('import_warnings')\n\t\t\t.$wrapper.find(`[data-col=${$target.data('col')}]`);\n\t\tfrappe.utils.scroll_to($warning, true, 30);\n\t}\n\n\tshow_column_mapper() {\n\t\tlet column_picker_fields = get_columns_for_picker(this.doctype);\n\t\tlet changed = [];\n\t\tlet fields = this.preview_data.columns.map((col, i) => {\n\t\t\tlet df = col.df;\n\t\t\tif (col.header_title === 'Sr. No') return [];\n\n\t\t\tlet fieldname;\n\t\t\tif (!df) {\n\t\t\t\tfieldname = null;\n\t\t\t} else if (col.map_to_field) {\n\t\t\t\tfieldname = col.map_to_field;\n\t\t\t} else if (col.is_child_table_field) {\n\t\t\t\tfieldname = `${col.child_table_df.fieldname}.${df.fieldname}`;\n\t\t\t} else {\n\t\t\t\tfieldname = df.fieldname;\n\t\t\t}\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tdefault: col.header_title,\n\t\t\t\t\tfieldname: `Column ${i}`,\n\t\t\t\t\tread_only: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Autocomplete',\n\t\t\t\t\tfieldname: i,\n\t\t\t\t\tlabel: '',\n\t\t\t\t\tmax_items: Infinity,\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __(\"Don't Import\"),\n\t\t\t\t\t\t\tvalue: \"Don't Import\"\n\t\t\t\t\t\t}\n\t\t\t\t\t].concat(get_fields_as_options(this.doctype, column_picker_fields)),\n\t\t\t\t\tdefault: fieldname || \"Don't Import\",\n\t\t\t\t\tchange() {\n\t\t\t\t\t\tchanged.push(i);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Section Break'\n\t\t\t\t}\n\t\t\t];\n\t\t});\n\t\t// flatten the array\n\t\tfields = fields.reduce((acc, curr) => [...acc, ...curr]);\n\t\tlet file_name = (this.frm.doc.import_file || '').split('/').pop();\n\t\tlet parts = [file_name.bold(), this.doctype.bold()];\n\t\tfields = [\n\t\t\t{\n\t\t\t\tfieldtype: 'HTML',\n\t\t\t\tfieldname: 'heading',\n\t\t\t\toptions: `\n\t\t\t\t\t<div class=\"margin-top text-muted\">\n\t\t\t\t\t${__('Map columns from {0} to fields in {1}', parts)}\n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: 'Section Break'\n\t\t\t}\n\t\t].concat(fields);\n\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Map Columns'),\n\t\t\tfields,\n\t\t\tprimary_action: values => {\n\t\t\t\tlet changed_map = {};\n\t\t\t\tchanged.map(i => {\n\t\t\t\t\tlet header_row_index = i - 1;\n\t\t\t\t\tchanged_map[header_row_index] = values[i];\n\t\t\t\t});\n\t\t\t\tif (changed.length > 0) {\n\t\t\t\t\tthis.events.remap_column(changed_map);\n\t\t\t\t}\n\t\t\t\tdialog.hide();\n\t\t\t}\n\t\t});\n\t\tdialog.$body.addClass('map-columns');\n\t\tdialog.show();\n\t}\n\n\tis_row_imported(row) {\n\t\tlet serial_no = row[0].content;\n\t\treturn this.import_log.find(log => {\n\t\t\treturn log.success && log.row_indexes.includes(serial_no);\n\t\t});\n\t}\n};\n\nfunction get_fields_as_options(doctype, column_map) {\n\tlet keys = [doctype];\n\tfrappe.meta.get_table_fields(doctype).forEach(df => {\n\t\tkeys.push(df.fieldname);\n\t});\n\t// flatten array\n\treturn [].concat(\n\t\t...keys.map(key => {\n\t\t\treturn column_map[key].map(df => {\n\t\t\t\tlet label = df.label;\n\t\t\t\tlet value = df.fieldname;\n\t\t\t\tif (doctype !== key) {\n\t\t\t\t\tlet table_field = frappe.meta.get_docfield(doctype, key);\n\t\t\t\t\tlabel = `${df.label} (${table_field.label})`;\n\t\t\t\t\tvalue = `${table_field.fieldname}.${df.fieldname}`;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tlabel,\n\t\t\t\t\tvalue,\n\t\t\t\t\tdescription: value\n\t\t\t\t};\n\t\t\t});\n\t\t})\n\t);\n}\n"],"names":["this","let","const","column_title"],"mappings":"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"}